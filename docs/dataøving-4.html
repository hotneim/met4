<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.4 Dataøving 4 | MET4 - Empiriske Metoder - Vår 2023</title>
  <meta name="description" content="Dette er hjemmesiden til kurset MET4 - Empiriske Metoder, som gis på bachelorstudiet ved Norges Handelshøyskole." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="7.4 Dataøving 4 | MET4 - Empiriske Metoder - Vår 2023" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Dette er hjemmesiden til kurset MET4 - Empiriske Metoder, som gis på bachelorstudiet ved Norges Handelshøyskole." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.4 Dataøving 4 | MET4 - Empiriske Metoder - Vår 2023" />
  
  <meta name="twitter:description" content="Dette er hjemmesiden til kurset MET4 - Empiriske Metoder, som gis på bachelorstudiet ved Norges Handelshøyskole." />
  

<meta name="author" content="Håkon Otneim og Geir Drage Berentsen" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataøving-3.html"/>
<link rel="next" href="dataøving-5.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link rel="apple-touch-icon" sizes="180x180" href="/met4/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/met4/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/met4/icon/favicon-16x16.png">
<link rel="manifest" href="/met4/icon/site.webmanifest">
<link rel="mask-icon" href="/met4/icon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/met4/icon/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/met4/icon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<a href="https://www.nhh.no/"><img src="bilder/nhh.png" width="240"></a>
<li><a href="./index.html">MET4 - EMPIRISKE METODER</a></li>

<li class="divider"></li>
<li><a href="index.html#innledning" id="toc-innledning">Innledning</a></li>
<li><a href="introduksjon-til-r.html#introduksjon-til-r" id="toc-introduksjon-til-r"><span class="toc-section-number">1</span> Introduksjon til R</a>
<ul>
<li><a href="en-gjennomgang-av-rstudio.html#en-gjennomgang-av-rstudio" id="toc-en-gjennomgang-av-rstudio"><span class="toc-section-number">1.1</span> En gjennomgang av RStudio</a></li>
<li><a href="enkle-beregninger-og-variabler.html#enkle-beregninger-og-variabler" id="toc-enkle-beregninger-og-variabler"><span class="toc-section-number">1.2</span> Enkle beregninger og variabler</a></li>
<li><a href="vektorer.html#vektorer" id="toc-vektorer"><span class="toc-section-number">1.3</span> Vektorer</a></li>
<li><a href="pakker.html#pakker" id="toc-pakker"><span class="toc-section-number">1.4</span> Pakker</a></li>
<li><a href="mappesti.html#mappesti" id="toc-mappesti"><span class="toc-section-number">1.5</span> Mappesti</a></li>
<li><a href="innlesing-av-data.html#innlesing-av-data" id="toc-innlesing-av-data"><span class="toc-section-number">1.6</span> Innlesing av data</a></li>
<li><a href="statistiske-analyser.html#statistiske-analyser" id="toc-statistiske-analyser"><span class="toc-section-number">1.7</span> Statistiske analyser</a></li>
<li><a href="r-plotting.html#r-plotting" id="toc-r-plotting"><span class="toc-section-number">1.8</span> Plotting</a></li>
<li><a href="script.html#script" id="toc-script"><span class="toc-section-number">1.9</span> Script</a></li>
<li><a href="pipe.html#pipe" id="toc-pipe"><span class="toc-section-number">1.10</span> Pipe-operatoren <code>%&gt;%</code> og enkel datavask</a></li>
<li><a href="r-ekstra.html#r-ekstra" id="toc-r-ekstra"><span class="toc-section-number">1.11</span> Oppsummering og ekstra oppgaver</a></li>
</ul></li>
<li><a href="grunnleggende-statistikk.html#grunnleggende-statistikk" id="toc-grunnleggende-statistikk"><span class="toc-section-number">2</span> Grunnleggende statistikk</a>
<ul>
<li><a href="deskriptiv-statistikk.html#deskriptiv-statistikk" id="toc-deskriptiv-statistikk"><span class="toc-section-number">2.1</span> Deskriptiv statistikk</a></li>
<li><a href="utvalg-og-estimering.html#utvalg-og-estimering" id="toc-utvalg-og-estimering"><span class="toc-section-number">2.2</span> Utvalg og estimering</a></li>
<li><a href="oppgaverdeskriptiv.html#oppgaverdeskriptiv" id="toc-oppgaverdeskriptiv"><span class="toc-section-number">2.3</span> Oppgaver</a></li>
<li><a href="relevant-r-grunnleggende.html#relevant-r-grunnleggende" id="toc-relevant-r-grunnleggende"><span class="toc-section-number">2.4</span> Relevante R-kommandoer</a></li>
</ul></li>
<li><a href="hypotesetesting.html#hypotesetesting" id="toc-hypotesetesting"><span class="toc-section-number">3</span> Hypotesetesting</a>
<ul>
<li><a href="generelt-om-hypotesetesting.html#generelt-om-hypotesetesting" id="toc-generelt-om-hypotesetesting"><span class="toc-section-number">3.1</span> Generelt om hypotesetesting</a></li>
<li><a href="enpop.html#enpop" id="toc-enpop"><span class="toc-section-number">3.2</span> Inferens om en populasjon</a></li>
<li><a href="inferens-om-to-populasjoner.html#inferens-om-to-populasjoner" id="toc-inferens-om-to-populasjoner"><span class="toc-section-number">3.3</span> Inferens om to populasjoner</a></li>
<li><a href="kjikvadrattester.html#kjikvadrattester" id="toc-kjikvadrattester"><span class="toc-section-number">3.4</span> Kjikvadrattester</a></li>
<li><a href="oppgaver.html#oppgaver" id="toc-oppgaver"><span class="toc-section-number">3.5</span> Oppgaver</a></li>
<li><a href="relevante-r-testing.html#relevante-r-testing" id="toc-relevante-r-testing"><span class="toc-section-number">3.6</span> Relevante R-kommandoer</a></li>
</ul></li>
<li><a href="regresjon.html#regresjon" id="toc-regresjon"><span class="toc-section-number">4</span> Regresjon</a>
<ul>
<li><a href="enkel-regresjon.html#enkel-regresjon" id="toc-enkel-regresjon"><span class="toc-section-number">4.1</span> Enkel regresjon</a></li>
<li><a href="multippel-regresjon.html#multippel-regresjon" id="toc-multippel-regresjon"><span class="toc-section-number">4.2</span> Multippel regresjon</a></li>
<li><a href="modellbygging.html#modellbygging" id="toc-modellbygging"><span class="toc-section-number">4.3</span> Modellbygging</a></li>
<li><a href="oppgaver-1.html#oppgaver-1" id="toc-oppgaver-1"><span class="toc-section-number">4.4</span> Oppgaver</a></li>
<li><a href="relevante-r-regresjon.html#relevante-r-regresjon" id="toc-relevante-r-regresjon"><span class="toc-section-number">4.5</span> Relevante R-kommandoer</a></li>
</ul></li>
<li><a href="tidsrekker.html#tidsrekker" id="toc-tidsrekker"><span class="toc-section-number">5</span> Tidsrekker</a>
<ul>
<li><a href="intro.html#intro" id="toc-intro"><span class="toc-section-number">5.1</span> Introduksjon til tidsrekker</a></li>
<li><a href="trend-og-sesong.html#trend-og-sesong" id="toc-trend-og-sesong"><span class="toc-section-number">5.2</span> Trend og sesong</a></li>
<li><a href="ar.html#ar" id="toc-ar"><span class="toc-section-number">5.3</span> AR(p)</a></li>
<li><a href="stasjonaritet.html#stasjonaritet" id="toc-stasjonaritet"><span class="toc-section-number">5.4</span> Stasjonaritet</a></li>
<li><a href="autokorrelasjon.html#autokorrelasjon" id="toc-autokorrelasjon"><span class="toc-section-number">5.5</span> Autokorrelasjon</a></li>
<li><a href="ma.html#ma" id="toc-ma"><span class="toc-section-number">5.6</span> MA(q)</a></li>
<li><a href="arma-arima.html#arma-arima" id="toc-arma-arima"><span class="toc-section-number">5.7</span> ARMA og ARIMA</a></li>
<li><a href="modellbygging-1.html#modellbygging-1" id="toc-modellbygging-1"><span class="toc-section-number">5.8</span> Modellbygging</a></li>
<li><a href="oppgaver-2.html#oppgaver-2" id="toc-oppgaver-2"><span class="toc-section-number">5.9</span> Oppgaver</a></li>
<li><a href="relevante-r-tidsrekker.html#relevante-r-tidsrekker" id="toc-relevante-r-tidsrekker"><span class="toc-section-number">5.10</span> Relevante R-kommandoer</a></li>
</ul></li>
<li><a href="avansert-regresjon-og-maskinlæring.html#avansert-regresjon-og-maskinlæring" id="toc-avansert-regresjon-og-maskinlæring"><span class="toc-section-number">6</span> Avansert regresjon og maskinlæring</a>
<ul>
<li><a href="logistisk-regresjon.html#logistisk-regresjon" id="toc-logistisk-regresjon"><span class="toc-section-number">6.1</span> Logistisk regresjon</a></li>
<li><a href="introduksjon-til-maskinlæring-med-knn.html#introduksjon-til-maskinlæring-med-knn" id="toc-introduksjon-til-maskinlæring-med-knn"><span class="toc-section-number">6.2</span> Introduksjon til maskinlæring med kNN</a></li>
<li><a href="paneldata.html#paneldata" id="toc-paneldata"><span class="toc-section-number">6.3</span> Paneldata</a></li>
<li><a href="oppgaver-3.html#oppgaver-3" id="toc-oppgaver-3"><span class="toc-section-number">6.4</span> Oppgaver</a></li>
<li><a href="relevante-r-avansert-regresjon.html#relevante-r-avansert-regresjon" id="toc-relevante-r-avansert-regresjon"><span class="toc-section-number">6.5</span> Relevante R-kommandoer</a></li>
</ul></li>
<li><a href="dataøvinger.html#dataøvinger" id="toc-dataøvinger"><span class="toc-section-number">7</span> Dataøvinger</a>
<ul>
<li><a href="dataøving-1.html#dataøving-1" id="toc-dataøving-1"><span class="toc-section-number">7.1</span> Dataøving 1</a></li>
<li><a href="dataøving-2.html#dataøving-2" id="toc-dataøving-2"><span class="toc-section-number">7.2</span> Dataøving 2</a></li>
<li><a href="dataøving-3.html#dataøving-3" id="toc-dataøving-3"><span class="toc-section-number">7.3</span> Dataøving 3</a></li>
<li><a href="dataøving-4.html#dataøving-4" id="toc-dataøving-4"><span class="toc-section-number">7.4</span> Dataøving 4</a></li>
<li><a href="dataøving-5.html#dataøving-5" id="toc-dataøving-5"><span class="toc-section-number">7.5</span> Dataøving 5</a></li>
</ul></li>
<li><a href="seminar.html#seminar" id="toc-seminar"><span class="toc-section-number">8</span> Seminaroppgaver</a>
<ul>
<li><a href="seminar-1-grunnleggende-statistikk.html#seminar-1---grunnleggende-statistikk" id="toc-seminar-1---grunnleggende-statistikk"><span class="toc-section-number">8.1</span> Seminar 1 - Grunnleggende statistikk</a></li>
<li><a href="seminar-2-hypotesetesting.html#seminar-2---hypotesetesting" id="toc-seminar-2---hypotesetesting"><span class="toc-section-number">8.2</span> Seminar 2 - Hypotesetesting</a></li>
<li><a href="seminar-3-regresjon-i.html#seminar-3---regresjon-i" id="toc-seminar-3---regresjon-i"><span class="toc-section-number">8.3</span> Seminar 3 - Regresjon I</a></li>
<li><a href="seminar-4-regresjon-ii.html#seminar-4---regresjon-ii" id="toc-seminar-4---regresjon-ii"><span class="toc-section-number">8.4</span> Seminar 4 - Regresjon II</a></li>
<li><a href="seminar-5-tidsrekker.html#seminar-5---tidsrekker" id="toc-seminar-5---tidsrekker"><span class="toc-section-number">8.5</span> Seminar 5 - Tidsrekker</a></li>
<li><a href="seminar-6-avansert-regresjon-og-maskinlæring.html#seminar-6---avansert-regresjon-og-maskinlæring" id="toc-seminar-6---avansert-regresjon-og-maskinlæring"><span class="toc-section-number">8.6</span> Seminar 6 - Avansert regresjon og maskinlæring</a></li>
</ul></li>
<li><a href="eksamensoppgaver.html#eksamensoppgaver" id="toc-eksamensoppgaver"><span class="toc-section-number">9</span> Eksamensoppgaver</a>
<ul>
<li><a href="skoleeksamen.html#skoleeksamen" id="toc-skoleeksamen"><span class="toc-section-number">9.1</span> Tidligere eksamensoppgaver (skoleeksamen)</a></li>
<li><a href="tidligere-eksamensoppgaver-hjemmeeksamen.html#tidligere-eksamensoppgaver-hjemmeeksamen" id="toc-tidligere-eksamensoppgaver-hjemmeeksamen"><span class="toc-section-number">9.2</span> Tidligere eksamensoppgaver (hjemmeeksamen)</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.nhh.no/en/employees/faculty/hakon-otneim/">Håkon Otneim</a></li>
<li><a href="https://www.nhh.no/en/employees/faculty/geir-drage-berentsen/">Geir Drage Berentsen</a></li>
<li><a href="https://github.com/rstudio/bookdown">
Publisert ved hjelp av bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MET4 - Empiriske Metoder - Vår 2023</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dataøving-4" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Dataøving 4</h2>
<p>En produsent som vil selge kraft til Nord Pool leverer salgsbud til kraftbørsen som spesifiserer, for hver time neste dag, hvor mange megawatt (MW) man er villig til å produsere til ulike priser. Fristen for å levere salgsbud er kl 12:00 dagen før produksjonen skal finne sted. For en vindkraftprodusent er det flere usikre faktorer man må ta stilling til når man skal levere salgsbud for neste dag:</p>
<ol style="list-style-type: decimal">
<li>Timeprisene i spotmarkedet (Euro/MW) er ukjente (blir ikke offentliggjort før kl 12:45).</li>
<li>For å vite hvor mange megawatt (MW) man kan produsere i en gitt time trenger man å vite vindstyrken. Selv med gode værprognoser vil det fremdeles være betydelig usikkerhet knyttet til vindstyrken i de ulike timene neste dag.</li>
<li>Dersom den faktiske produksjonen avviker fra det man har meldt inn vil det påløpe en straffekostnad. I timer med mye vind vil man måtte selge den overskytende produksjonen til en lavere pris enn spotprisen, og i timer med lite vind vil man måtte kompensere fleksible produsenter for å dekke opp for den manglende produksjonen. Straffekostnaden (Euro/MW) for over- eller underproduksjon er en ukjent størrelse på budgivningstidspunktet.</li>
</ol>
<p>I denne dataøvingen skal vi konsentrere oss om å lage prognoser for spotprisen. I case 3 i BED4 kommer dere også til å få bruk for vindstyrken og straffekostnadene, men å lage prognoser for disse vil kreve ferdigheter utover det som gjennomgås i MET4.</p>
<p>Hvis du ikke tar BED4 dette semesteret, så går det helt fint også. Dataøvingen står fint på egne bein, og du kan uansett komme tilbake til disse resultatene hvis du for eksempel skal ta BED4 på et senere tidspunkt.</p>
<p>Du har kanskje lagt merke til at R-kodingen i tidsrekkemodulen har en litt forskjellig stil fra det vi har gjort tidligere i kurset. I denne øvingen vil derfor størsteparten av koden blir oppgitt i oppgaveteksten. Din oppgave blir å kjøre koden, få ut figurer og resultater, samt å kommentere og tolke resultatene.</p>
<p>Vi starter med å laste inn noen pakker som vi kommer til å trenge. Som vanlig må du installere pakkene først dersom du ikke har gjort det allerede:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="dataøving-4.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb278-2"><a href="dataøving-4.html#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="oppgave-1-last-inn-og-se-på-datasettet" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Oppgave 1: Last inn og se på datasettet</h3>
<p>Denne gang er datasettet pakket inn i en såkalt <code>.Rdata</code>-fil. Det er et enkelt filformat for å lagre R-objekter. Last ned <a href="datasett/p_da.Rdata">p_da.Rdata</a>, og last datasettet inn i R ved å kjøre følgende kommando (der du selvsagt har satt arbeidsmappen til der du har lagt datafilen):</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="dataøving-4.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;p_DA.Rdata&quot;</span>)</span></code></pre></div>
<p>Du skal nå få to tidsrekker i minnet: <code>n03</code> og <code>no5</code>, som i figuren under:</p>
<p><img src="bilder/environ.png" width="800" /></p>
<p>Disse to tidsrekkene inneholder strømprisen i to prisområder i Norge hver time fra 1. januar 2022 til og med 21. september 2022. Tidsrekken <code>no3</code> inneholder prisen for Midt-Norge (NO3) og <code>no5</code> inneholder prisen for Vest-Norge (NO5).</p>
<p>Vi konsentrerer oss om NO3 i første omgang, og kikker raskt på datasettet ved å plotte tidsrekken direkte med <code>autoplot()</code>-funksjonen som vi finner i <code>forecast</code>-pakken:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="dataøving-4.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(no3)</span></code></pre></div>
<p><img src="met4_files/figure-html/unnamed-chunk-259-1.png" width="672" /></p>
<p>På <span class="math inline">\(x\)</span>-aksen har vi antall dager siden 1. januar 2022. Skriv en kort kommentar der du peker på noen viktige karakteristikker ved denne tidsrekken. Du må gjerne bruke <code>xlim</code>-argumentet i <code>plot()</code>-funksjonen for å zoome inn og se på mindre tidsperioder. Ser tidsrekken ut til å være stasjonær?</p>
</div>
<div id="oppgave-2-gjem-bort-den-siste-dagen-slik-at-vi-kan-sjekke-prediksjonene-våre" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Oppgave 2: Gjem bort den siste dagen slik at vi kan sjekke prediksjonene våre</h3>
<p>For å kunne gjøre en vurdering av hvor gode prediksjonene våre er, deler vi nå datasettet vårt i to, der vi tar ut de siste 24 timene som vi kan bruke til å evaluere prediksjonene. Vi kaller disse to delene <code>no3_train</code>, som er den lange delen som vi skal bruke til å estimere en modell (<em>trene</em> en modell), og <code>no3_test</code> som er de siste 24 timene som vi skal bruke til å teste etterpå om modellen duger.</p>
<p>Vi bruker funksjonen <code>window()</code> til å hente ut deler av tidsrekken, der vi må spesifisere start- og sluttverdier som vektorer med to elementer; en for dag og en for time. Det er 264 dager i datasettet vårt, så da får vi:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="dataøving-4.html#cb281-1" aria-hidden="true" tabindex="-1"></a>no3_train <span class="ot">&lt;-</span> <span class="fu">window</span>(no3, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">263</span>, <span class="dv">23</span>))</span>
<span id="cb281-2"><a href="dataøving-4.html#cb281-2" aria-hidden="true" tabindex="-1"></a>no3_test  <span class="ot">&lt;-</span> <span class="fu">window</span>(no3, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">264</span>, <span class="dv">0</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">264</span>, <span class="dv">23</span>))</span></code></pre></div>
<p>Du kan nå dobbelsjekke at du har fått ut en enkelt dag i <code>no3_test</code> ved å kjøre <code>autoplot(no3_test)</code>.</p>
</div>
<div id="oppgave-3-hent-ut-sesong-og-trend" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Oppgave 3: Hent ut sesong og trend</h3>
<p>Vi har lært at et første steg i tidsrekkeanalyse er å hente ut eventuelle sesong og trendkomponenter. Vi har også sett at det er en enkel funksjon i R som kan gjøre dette for oss, nemlig <code>stl()</code>, slik vi så i <a href="trend-og-sesong.html#trend-og-sesong">seksjonen om trend og sesong</a>.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="dataøving-4.html#cb282-1" aria-hidden="true" tabindex="-1"></a>dekomponert <span class="ot">&lt;-</span> <span class="fu">stl</span>(no3_train, <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb282-2"><a href="dataøving-4.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(dekomponert)</span></code></pre></div>
<p><img src="met4_files/figure-html/unnamed-chunk-261-1.png" width="672" /></p>
<p>Det var ikke så lett å se detaljer i sesongkomponenten i dette plottet, så vi zoomer inn på en mindre del av x-aksen:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="dataøving-4.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(dekomponert) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">245</span>, <span class="dv">260</span>)</span></code></pre></div>
<p><img src="met4_files/figure-html/unnamed-chunk-262-1.png" width="672" /></p>
<p>Gi en kort beskrivelse av de ulike komponentene i tidsrekken.</p>
</div>
<div id="oppgave-4-prediker-treningstidsrekken-24-steg-frem-og-visualiser-resultatene." class="section level3" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Oppgave 4: Prediker treningstidsrekken 24 steg frem og visualiser resultatene.</h3>
<p>Vi skal nå slippe veldig billig unna! Denne oppgaven består egentlig av flere steg:</p>
<ol style="list-style-type: decimal">
<li>Finn en statistisk modell for residualtidsrekken. Bruk for eksempel <code>auto.arima()</code> for å finne den ARIMA-modellen som passer best til treningsdatasettet.</li>
<li>Bruk denne modellen til å predikere residualtidsrekken 24 steg frem.</li>
<li>Skriv trendserien 24 steg frem. Her må vi ha en fornuftig måte å ekstrapolere som vi ikke har dekket eksplisitt i materialet vårt.</li>
<li>Hekt på en ny dag med den daglige sesongvariasjonen.</li>
<li>Legg sammen prediksjonene av residualene, trend- og sesongkomponenten for å lage en prediksjon av prisserien.</li>
</ol>
<p>Vi kunne godt satt oss ned for å programmere disse stegene hver for seg. Heldigvis har noen gjort dette før oss, gjennom funksjonen <code>forecast()</code> i <code>forecast</code>-pakken. For å lage en prognose må vi sende inn den dekomponerte tidsrekken, sammen med en spesifikasjon av hvilken type statistisk tidsrekkemodell vi ønsker å tilpasse til residualtidsrekken (vi velger ARIMA, for det er den modellen vi har lært om), og hvor mange steg frem vi ønsker å predikere. Vi kan også legge til signifikansnivået for et prediksjonsintervall som vi vil ha på 95%:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="dataøving-4.html#cb284-1" aria-hidden="true" tabindex="-1"></a>prognose <span class="ot">&lt;-</span> <span class="fu">forecast</span>(dekomponert, <span class="at">method =</span> <span class="st">&quot;arima&quot;</span>, <span class="at">h =</span> <span class="dv">24</span>, <span class="at">level =</span> <span class="dv">95</span>)</span></code></pre></div>
<p>Vi kan visualisere resultatet ved hjelp av <code>autoplot()</code>. For å kunne se noe fornuftig i plottet så tar vi bare med de 100 siste observerte tidsstegene i tillegg til de 24 prediksjonene:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="dataøving-4.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prognose, <span class="at">include =</span> <span class="dv">100</span>)</span></code></pre></div>
<p><img src="met4_files/figure-html/unnamed-chunk-264-1.png" width="672" /></p>
<p>Gi en kommentar til dette plottet.</p>
</div>
<div id="oppgave-5-sammenlign-prediksjonene-med-de-faktiske-observasjonene" class="section level3" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> Oppgave 5: Sammenlign prediksjonene med de faktiske observasjonene</h3>
<p>Vi kan nå finne frem igjen <code>no3_test</code>, som er en tidsrekke som inneholder de faktiske observasjonene for dagen der vi har gjort prediksjoner. La oss sammenligne. En måte å visualisere dette på er å hente ut prediksjonene fra <code>prognose</code>-objektet (de ligger under <code>$mean</code>), og sette det sammen med de faktiske observasjonene (som vi har lagret i <code>no3_test</code>). Vi kan også hente ut prediksjonsintervallene, og sette alt inn i en data frame:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="dataøving-4.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setter prediksjoner, intervaller og observasjoner inn i samme data frame.  </span></span>
<span id="cb286-2"><a href="dataøving-4.html#cb286-2" aria-hidden="true" tabindex="-1"></a>prediksjoner <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb286-3"><a href="dataøving-4.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>,                            <span class="co"># Timer i døgnet for x-aksen</span></span>
<span id="cb286-4"><a href="dataøving-4.html#cb286-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prediksjon =</span> prognose<span class="sc">$</span>mean,          <span class="co"># Predikerte priser</span></span>
<span id="cb286-5"><a href="dataøving-4.html#cb286-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nedre =</span> prognose<span class="sc">$</span>lower[,<span class="dv">1</span>],          <span class="co"># Nedre og øvre prediksjonsintervaller</span></span>
<span id="cb286-6"><a href="dataøving-4.html#cb286-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovre =</span> prognose<span class="sc">$</span>upper[,<span class="dv">1</span>],</span>
<span id="cb286-7"><a href="dataøving-4.html#cb286-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">observert =</span> no3_test                 <span class="co"># De faktiske observasjonene</span></span>
<span id="cb286-8"><a href="dataøving-4.html#cb286-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb286-9"><a href="dataøving-4.html#cb286-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-10"><a href="dataøving-4.html#cb286-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Lager plott</span></span>
<span id="cb286-11"><a href="dataøving-4.html#cb286-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prediksjoner) <span class="sc">+</span></span>
<span id="cb286-12"><a href="dataøving-4.html#cb286-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> prediksjon), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span>    <span class="co"># Prediksjoner</span></span>
<span id="cb286-13"><a href="dataøving-4.html#cb286-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> nedre), <span class="at">colour =</span> <span class="st">&quot;darkred&quot;</span>) <span class="sc">+</span>          <span class="co"># Nedre grense</span></span>
<span id="cb286-14"><a href="dataøving-4.html#cb286-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> ovre), <span class="at">colour =</span> <span class="st">&quot;darkred&quot;</span>) <span class="sc">+</span>           <span class="co"># Øvre grense</span></span>
<span id="cb286-15"><a href="dataøving-4.html#cb286-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> observert), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span>              <span class="co"># Observert</span></span>
<span id="cb286-16"><a href="dataøving-4.html#cb286-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb286-17"><a href="dataøving-4.html#cb286-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;24 timers prognose av strømpris&quot;</span>) <span class="sc">+</span></span>
<span id="cb286-18"><a href="dataøving-4.html#cb286-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="met4_files/figure-html/unnamed-chunk-265-1.png" width="672" /></p>
<p>I dette plottet er prediksjonene av strømprisen vist som en stiplet linje, mens de prisene som faktisk ble observert er vist som en tykk heltrukken linje. Kommenter plottet.</p>
</div>
<div id="oppgave-6-lag-prediksjoner-for-neste-dag" class="section level3" number="7.4.6">
<h3><span class="header-section-number">7.4.6</span> Oppgave 6: Lag prediksjoner for neste dag</h3>
<p>Så langt har vi brukt alle dagene i datasettet vårt <em>bortsett fra den siste</em> til å predikere strømprisen på den siste dagen. Resultatene ser ut til å være gode. Du kan nå gjenta denne prosedyren, men i stedet for tidsrekken <code>no3_train</code> skal du nå bruke hele tidsrekken <code>no3</code> til å predikere prisen for dagen etter det – den 22. september 2022 – en dag der vi ikke har de faktisk realiserte prisene i datasettet vårt.</p>
<p>Du skal få et prediksjonsplott som ser slik ut:</p>
<p><img src="met4_files/figure-html/unnamed-chunk-266-1.png" width="672" /></p>
<p>Du kan så samle prediksjonene i en data frame som i forrige oppgave, men der vi selvsagt ikke kan ha med en kolonne med observerte priser, siden vi ikke har dem tilgjengelige. Den endelige tabellen med observasjoner skal se slik ut:</p>
<pre><code>##     x prediksjon       nedre      ovre
## 1   1   36.02709  12.1495723  59.90460
## 2   2   36.45012   3.3208432  69.57940
## 3   3   37.28821  -3.5736943  78.15012
## 4   4   38.53910  -7.6663095  84.74451
## 5   5   39.89017  -9.5638644  89.34420
## 6   6   42.27134  -9.0837471  93.62643
## 7   7   43.55218  -8.9521015  96.05647
## 8   8   49.43543  -3.8202856 102.69114
## 9   9   54.36794   0.5712673 108.16460
## 10 10   56.23131   2.0083818 110.45425
## 11 11   54.74981   0.1657312 109.33389
## 12 12   51.32547  -3.5811987 106.23213
## 13 13   49.64904  -5.5564816 104.85456
## 14 14   47.41288  -8.0764075 102.90216
## 15 15   46.22697  -9.5361822 101.99013
## 16 16   46.70673  -9.3236145 102.73708
## 17 17   46.61878  -9.6740934 102.91166
## 18 18   48.72382  -7.8282025 105.27583
## 19 19   50.11119  -6.6974082 106.91979
## 20 20   50.21319  -6.8499490 107.27634
## 21 21   50.04209  -7.2739046 107.35808
## 22 22   48.34032  -9.2270566 105.90769
## 23 23   45.94396 -11.8734681 103.76139
## 24 24   42.20995 -15.8563146 100.27621</code></pre>
<p>Kommenter.</p>
</div>
<div id="oppgave-7-lagre-prediksjonene-i-en-excel-fil." class="section level3" number="7.4.7">
<h3><span class="header-section-number">7.4.7</span> Oppgave 7: Lagre prediksjonene i en excel-fil.</h3>
<p>Hvis du tar BED4 dette semesteret (eller skal ta BED4 på et senere tidspunkt) så trenger du nå å eksportere disse prediksjonene til en Excel-fil. En pakke som kan gjøre dette er <code>writexl</code> (som du, igjen, er nødt til å installere før bruk: <code>install.packages("writexl")</code>). Hvis du har lagret prediksjonene i en data frame som heter <code>prediksjoner2</code>, så kan du skrive den ut i en Excel-fil på følgende måte:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="dataøving-4.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb288-2"><a href="dataøving-4.html#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(prediksjoner2, <span class="st">&quot;no3_prediksjoner.xlsx&quot;</span>)</span></code></pre></div>
<p>Du skal nå ha en Excel-fil med prediksjonene dine i filen <code>no3_prediksjoner.xlsx</code> i arbeidsmappen din.</p>
</div>
<div id="oppgave-8-gjør-det-samme-for-no5" class="section level3" number="7.4.8">
<h3><span class="header-section-number">7.4.8</span> Oppgave 8: Gjør det samme for <code>no5</code></h3>
<p>Du kan nå gjenta øvelsen over for å få ut samme type prediksjoner for det andre prisområdet. Tidsrekken finner du i <code>no5</code> og prediksjonsplottet ser slik ut:</p>
<p><img src="met4_files/figure-html/unnamed-chunk-269-1.png" width="672" /></p>
<p>Data framen med prediksjonene skal se slik ut:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="dataøving-4.html#cb289-1" aria-hidden="true" tabindex="-1"></a>prediksjoner3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb289-2"><a href="dataøving-4.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>,                            <span class="co"># Timer i døgnet for x-aksen</span></span>
<span id="cb289-3"><a href="dataøving-4.html#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prediksjon =</span> prognose3<span class="sc">$</span>mean,          <span class="co"># Predikerte priser</span></span>
<span id="cb289-4"><a href="dataøving-4.html#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nedre =</span> prognose3<span class="sc">$</span>lower[,<span class="dv">1</span>],          <span class="co"># Nedre og øvre prediksjonsintervaller</span></span>
<span id="cb289-5"><a href="dataøving-4.html#cb289-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovre =</span> prognose3<span class="sc">$</span>upper[,<span class="dv">1</span>]</span>
<span id="cb289-6"><a href="dataøving-4.html#cb289-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb289-7"><a href="dataøving-4.html#cb289-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-8"><a href="dataøving-4.html#cb289-8" aria-hidden="true" tabindex="-1"></a>prediksjoner3</span></code></pre></div>
<pre><code>##     x prediksjon    nedre     ovre
## 1   1   346.3622 310.5934 382.1310
## 2   2   338.6796 286.6895 390.6698
## 3   3   344.5907 281.3350 407.8464
## 4   4   358.3632 286.3178 430.4086
## 5   5   378.5406 300.1708 456.9105
## 6   6   402.4033 319.0857 485.7209
## 7   7   424.7142 337.5252 511.9031
## 8   8   441.2872 350.5347 532.0397
## 9   9   441.0059 346.6958 535.3159
## 10 10   417.9910 319.6357 516.3462
## 11 11   393.0380 290.0513 496.0247
## 12 12   369.8592 261.5774 478.1409
## 13 13   352.9104 239.0015 466.8192
## 14 14   346.8510 227.3225 466.3794
## 15 15   350.4399 225.7535 475.1262
## 16 16   367.2739 238.1157 496.4321
## 17 17   390.4917 257.6416 523.3417
## 18 18   415.6232 279.7278 551.5187
## 19 19   433.2506 294.7538 571.7474
## 20 20   437.4176 296.4963 578.3390
## 21 21   429.5152 286.1074 572.9229
## 22 22   412.5279 266.3558 558.7000
## 23 23   390.6720 241.3325 540.0115
## 24 24   368.3594 215.4343 521.2845</code></pre>
<p>Du lagrer den som en Excel-fil slik:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="dataøving-4.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(prediksjoner3, <span class="st">&quot;no5_prediksjoner.xlsx&quot;</span>)</span></code></pre></div>
<p>Du kan laste ned de ferdige Excel-filene her for å kontrollere at du har fått det til: <a href="no3_prediksjoner.xlsx"><code>no3_prediksjoner.xlsx</code></a> og <a href="no5_prediksjoner.xlsx"><code>no5_prediksjoner.xlsx</code></a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataøving-3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dataøving-5.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"toc_depth": 4
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
